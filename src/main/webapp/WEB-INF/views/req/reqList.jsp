<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<%@include file="../module/head.jsp" %>

<!-- main-wrapper ÏïàÏóê sideBar/page-wrapper -->
<!-- page-wrapper ÏïàÏóê navbar/body-wrapper -->
<!-- body-wraaper ÏïàÏóê container-fluid -->
<!-- container-fluid ÏïàÏóê ÏûëÏóÖÌïòÏãúÎ©¥ Îê©ÎãàÎã§. -->
<style>
#reqTable td {
  color: black !important;
}
</style> 
  
<body class="link-sidebar">
<%@include file="../module/commonTags.jsp" %>
<div id="main-wrapper" class="main-wrapper" >

	<%@include file="../module/sideBar.jsp" %>
	<div class="page-wrapper">
	
		<%@include file="../module/navBar.jsp" %>
		<div class="body-wrapper">
			<div class="container-fluid">
				<!-- ÏûëÏóÖ ÏòÅÏó≠ Start -->
				
			    <div class="card card-body py-3">
			  		<div class="row align-items-center">
		  	  		<h4 class="mb-4 mb-sm-0 card-title">Î∞úÏ£º Ï°∞Ìöå</h4>
			    	</div>
			    </div>
				
				<div class="card">
					<div class="px-4 py-3 border-bottom">
						<h4 class="card-title mb-0">üîç Í≤ÄÏÉâ</h4>
					</div>
					<div class="card-body">
						<form id="searchForm">
                            <!-- ÌéòÏù¥ÏßïÏö© currentPage -->
                            <input type="hidden" name="currentPage" id="currentPage" value="1" />

                            <div class="row mb-3">
                                <!-- Î∞úÏ£º Íµ¨Î∂Ñ -->
                                <div class="col-md-4">
                                    <label class="form-label" for="reqType">Î∞úÏ£º Íµ¨Î∂Ñ</label>
                                    <select class="form-control form-control-sm" name="reqType" id="reqType">
                                        <option value="">-- ÏÑ†ÌÉù --</option>
                                        <option value="1">ÏàòÎèô</option>
                                        <option value="2">ÏûêÎèô</option>
                                    </select>
                                </div>
                                <!-- Î∞úÏ£º Í≤ÄÏÉâ ÏãúÏûë ÎÇ†Ïßú -->
                                <div class="col-md-4">
                                    <label class="form-label" for="reqDateS">Î∞úÏ£º ÏãúÏûëÏùº</label>
                                    <input class="form-control form-control-sm" type="date" id="reqDateS" name="reqDateS" />
                                </div>
                                <!-- Î∞úÏ£º Í≤ÄÏÉâ Ï¢ÖÎ£å ÎÇ†Ïßú -->
                                <div class="col-md-4">
                                    <label class="form-label" for="reqDateE">Î∞úÏ£º Ï¢ÖÎ£åÏùº</label>
                                    <input class="form-control form-control-sm" type="date" id="reqDateE" name="reqDateE" />
                                </div>
                            </div>

                            <div class="row mb-3">
                                <!-- Î∞úÏ£ºÏûê Î™Ö -->
                                <div class="col-md-4">
                                    <label class="form-label" for="reqstrNm">Î∞úÏ£ºÏûê Î™Ö</label>
                                    <input class="form-control form-control-sm" type="text" id="reqstrNm" name="reqstrNm" />
                                </div>
                                <!-- ÌòëÎ†•ÏóÖÏ≤¥ Î™Ö -->
                                <div class="col-md-4">
                                    <label class="form-label" for="suplrNm">ÌòëÎ†•ÏóÖÏ≤¥ Î™Ö</label>
                                    <input class="form-control form-control-sm" type="text" id="suplrNm" name="suplrNm" />
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="reqSttus">Î∞úÏ£º ÏöîÏ≤≠ ÏÉÅÌÉú</label>
                                    <select class="form-control form-control-sm" name="reqSttus" id="reqSttus">
                                        <option value="">-- ÏÑ†ÌÉù --</option>
                                        <option value="1">ÏöîÏ≤≠Ï§ë</option>
                                        <option value="2">Î∞úÏ£º ÏäπÏù∏</option>
                                        <option value="3">ÏûÖÍ≥† ÏôÑÎ£å</option>
                                        <option value="4">Î∞òÎ†§</option>
                                    </select>
                                </div>
                            </div>
                            <div class="text-end mt-3">
                                <button type="button" class="btn btn-primary" id="searchFormSubmitBtn">
                                    <i class="ti ti-search fs-5"></i>
                                    <span>Í≤ÄÏÉâ</span>
                                </button>
                                <button type="button" class="btn btn-primary" id="searchFormResetBtn">
                                    <i class="ti ti-trash fs-5"></i>
                                    <span>Ï¥àÍ∏∞Ìôî</span>
                                </button>
                            </div>
                        </form>
					</div>
				</div>
				
				<div class="card">
					<div class="px-4 py-3 border-bottom">
						<h4 class="card-title mb-0">üìë Í≤∞Í≥º</h4>
					</div>
					<div class="card-body">
						
					<div class="table-responsive mb-4 border rounded-1">
					    <table id="reqTable" class="table text-nowrap mb-0 align-middle">
					        <thead class="text-dark fs-4">
					            <tr>
					                <th>
					                    <h6 class="fs-4 fw-semibold mb-0" >[Íµ¨Î∂Ñ]Î∞úÏ£ºÎ≤àÌò∏</h6>
					                </th>
					                <th>
					                    <h6 class="fs-4 fw-semibold mb-0">ÌòëÎ†•ÏóÖÏ≤¥Î™Ö</h6>
					                </th>
					                <th>
					                    <h6 class="fs-4 fw-semibold mb-0">Î∞úÏ£ºÏûê</h6>
					                </th>
					                <th>
					                    <h6 class="fs-4 fw-semibold mb-0">Ï£ºÎ¨∏ÏùºÏûê(ÏãúÍ∞Ñ)</h6>
					                </th>
					            </tr>
					        </thead>
					        <tbody id="reqList">
					        	<!-- DataTableArea  -->
					        	
					        </tbody>
					    </table>
					</div>						
						
						<div class="d-flex justify-content-between align-items-center mt-3">
							<button type="button" class="btn btn-primary" onclick="location.href='/batirplan/resrce/req/handreq'">Ïã†Í∑ú</button>
						
							<div class="flex-grow-1 d-flex justify-content-center">
								<div id="pagingArea" style="margin-top: 10px; text-align: center;">
								
								</div>
							</div>
						</div>
					</div>
				</div>
				
		  		<!-- ÏûëÏóÖ ÏòÅÏó≠ End -->
	  		</div>
  		</div>
	</div>
</div>
    
<%@include file="../module/footerScript.jsp" %>
<script type="text/javascript">
$(function(){

	getReqList(1);
	
	$("#searchFormSubmitBtn").on("click", function(){
		getReqList(1); // Ï≤´ ÌéòÏù¥ÏßÄÎ∂ÄÌÑ∞ Í≤ÄÏÉâ
    });
	
    $("#searchFormResetBtn").on("click", function(){
        document.getElementById("searchForm").reset();

        getReqList(1);
    });
	
})

function getReqList(page){
    // 1) ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ Í∞ùÏ≤¥Î°ú ÌååÎùºÎØ∏ÌÑ∞ Íµ¨ÏÑ±
    var paramObj = {
        reqType:     $("#reqType").val(),
        reqDateS:    $("#reqDateS").val(),
        reqDateE:    $("#reqDateE").val(),
        reqstrNm:    $("#reqstrNm").val(),
        suplrNm:     $("#suplrNm").val(),
        reqSttus:    $("#reqSttus").val(),
        currentPage: page
    };
	
	
    $.ajax({
        url: "/batirplan/resrce/req/getreqlist",
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(paramObj),
        dataType: "json",
        success: function(res){
            console.log("ÏùëÎãµÎç∞Ïù¥ÌÑ∞:", res);

            // 1) Í∏∞Ï°¥ ÌÖåÏù¥Î∏î ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî
            $("#reqList").empty();

            // 2) Í≤∞Í≥º Î™©Î°ùÏùÑ ÌÖåÏù¥Î∏îÏóê Ï∂îÍ∞Ä
            if(res.dataList && res.dataList.length > 0){
                $.each(res.dataList, function(i, item){
                	var rowHtml = "<tr>"
                	    + "<td>"
                	      + "<a href='/batirplan/resrce/req/reqdetail?reqno=" + (item.reqNo || "") + "'>";
               	    if(item.reqType == 1) {
               	    	rowHtml += "[ÏàòÎèô]"
               	    } else{
               	    	rowHtml += "[ÏûêÎèô]"
               	    }
               	    rowHtml += (item.reqNo || "");
               	    
               	    if(item.reqSttus ==1){
               	    	rowHtml += "<span class='badge bg-secondary ms-2 me-0'>ÏöîÏ≤≠Ï§ë</span>";
               	    } else if(item.reqSttus == 2){
               	    	rowHtml += "<span class='badge bg-primary ms-2 me-0'>Î∞úÏ£ºÏäπÏù∏</span>";
               	    } else if(item.reqSttus == 3){
               	    	rowHtml += "<span class='badge bg-success ms-2 me-0'>ÏûÖÍ≥†ÏôÑÎ£å</span>";
               	    	/* rowHtml += "<span class='badge bg-succes ms-2 me-0'>ÏûÖÍ≥†ÏôÑÎ£å</span>"; */
               	    } else{
               	    	rowHtml += "<span class='badge bg-danger ms-2 me-0'>Î∞òÎ†§</span>";
               	    }
                	rowHtml += "</a>"
                	    + "</td>"
                	    + "<td>" + (item.suplrNm  || "") + "</td>";
                	    
                	if(item.reqstrNm == null){
                		rowHtml += ("<td>" + "-" + "</td>");
                	} else {
                		rowHtml += ("<td>" + (item.reqstrNm  || "") + "</td>");
                	}
               	    rowHtml += "<td>" + formatDateTime(item.reqDate) + "</td>"
                	    + "</tr>";
                    $("#reqList").append(rowHtml);
                });
            } else {
                // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
                $("#reqList").append("<tr><td colspan='4'>Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>");
            }

            // 3) ÌéòÏù¥Ïßï ÏòÅÏó≠ Î∞òÏòÅ
            $("#pagingArea").html(res.paging || "");
        },
        error: function(err){
            console.log(err);
            Swal.fire({
                icon: "error",
                title: "Ïò§Î•ò Î∞úÏÉù",
                text: "Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",
                confirmButtonText: "ÌôïÏù∏"
            });
        }
    });
    
}

$(document).on("click", "#pagingArea .page-link", function(e){
    e.preventDefault();
    
    // ÌÅ¥Î¶≠Ìïú ÌéòÏù¥ÏßÄ ÎßÅÌÅ¨Ïùò Î∂ÄÎ™® li ÌÉúÍ∑∏Í∞Ä active ÌÅ¥ÎûòÏä§Ïù∏ÏßÄ ÌôïÏù∏
    if ($(this).closest("li").hasClass("active")) {
        // Ïù¥ÎØ∏ ÌôúÏÑ±ÌôîÎêú ÌéòÏù¥ÏßÄÏù¥ÎØÄÎ°ú, ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÍ≥† Ï¢ÖÎ£å
        return false;
    }

    // ÌôúÏÑ±ÌôîÎêú ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãàÎùºÎ©¥, data-page Í∞íÏùÑ ÏùΩÏñ¥ Îã§Ïãú Ï°∞Ìöå
    var page = $(this).data("page");
    getReqList(page);
});

function formatDateTime(dateString) {
    if (!dateString) return ""; // Îπà Í∞í Ï≤òÎ¶¨

    const date = new Date(dateString);

    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, "0"); // Ïõî Î≥¥Ï†ï (+1) Î∞è 2ÏûêÎ¶¨ Î≥ÄÌôò
    const day = String(date.getDate()).padStart(2, "0");

    let hours = date.getHours(); // 24ÏãúÍ∞ÑÏ†ú Î≥ÄÌôò
    const minutes = String(date.getMinutes()).padStart(2, "0");

    // ‚úÖ 0ÏãúÎäî "00"ÏúºÎ°ú Ï≤òÎ¶¨
    const formattedHours = hours === 0 ? "00" : String(hours).padStart(2, "0");

    return `\${year}-\${month}-\${day} (\${formattedHours}:\${minutes})`;
}


</script>
</body>
</html>