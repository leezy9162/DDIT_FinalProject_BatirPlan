<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.batirplan.warehouse.mapper.IWarehouseMapper">

    <!-- üìå Ï∞ΩÍ≥† Î™©Î°ù Ï°∞Ìöå (Í≤ÄÏÉâ Í∏∞Îä• Î∞òÏòÅ) -->
    <select id="selectWarehouseList" parameterType="java.util.Map" resultType="kr.or.batirplan.warehouse.vo.WarehouseVO">
        SELECT 
            WRHOUS_CODE AS wrHousCode,         
            WRHOUS_NM AS wrHousNm,             
            WRHOUS_DETAIL_ADRES AS wrHousDetailAdres, 
            WRHOUS_ZIP AS wrHousZip,          
            WRHOUS_OPER_STTUS AS wrHousOperSttus,   
            PARTCLR_MATTER AS partclrMatter       
        FROM TB_WAREHOUSE
        WHERE 1=1
        <if test="wrHousNm != null and wrHousNm != ''">
            AND WRHOUS_NM LIKE '%' || #{wrHousNm} || '%'  
        </if>
        <if test="wrHousOperSttus != null and wrHousOperSttus != ''">
            AND WRHOUS_OPER_STTUS = #{wrHousOperSttus}
        </if>
        ORDER BY WRHOUS_NM ASC
    </select>

    <!-- üìå Ï∞ΩÍ≥† ÏÉÅÏÑ∏ Ï°∞Ìöå -->
    <select id="selectWarehouseByCode" parameterType="java.lang.String" resultType="kr.or.batirplan.warehouse.vo.WarehouseVO">
        SELECT 
            WRHOUS_CODE AS wrHousCode,         
            WRHOUS_NM AS wrHousNm,             
            WRHOUS_DETAIL_ADRES AS wrHousDetailAdres, 
            WRHOUS_ZIP AS wrHousZip,          
            WRHOUS_OPER_STTUS AS wrHousOperSttus,   
            PARTCLR_MATTER AS partclrMatter       
        FROM TB_WAREHOUSE
        WHERE WRHOUS_CODE = #{wrHousCode}
    </select>

    <!-- üìå Ï∞ΩÍ≥† Ï†ïÎ≥¥ Îì±Î°ù -->
    <insert id="insertWarehouse" parameterType="kr.or.batirplan.warehouse.vo.WarehouseVO">
        <selectKey keyProperty="wrHousCode" resultType="java.lang.String" order="BEFORE">
        	SELECT 'WH' || LPAD(SEQ_WAREHOUS.NEXTVAL, 3, '0') FROM DUAL
	 	</selectKey>

	    INSERT INTO TB_WAREHOUSE (
	        WRHOUS_CODE,
	        WRHOUS_NM,
	        WRHOUS_DETAIL_ADRES,
	        WRHOUS_ZIP,
	        WRHOUS_OPER_STTUS,
	        PARTCLR_MATTER
	    ) VALUES (
	        #{wrHousCode},  
	        #{wrHousNm},
	        #{wrHousDetailAdres},
	        #{wrHousZip},
	        #{wrHousOperSttus},
	        #{partclrMatter}
	    )
    </insert>

    <!-- üìå Ï∞ΩÍ≥† Ï†ïÎ≥¥ ÏàòÏ†ï -->
    <update id="updateWarehouse" parameterType="kr.or.batirplan.warehouse.vo.WarehouseVO">
        UPDATE TB_WAREHOUSE
        SET 
            WRHOUS_NM = #{wrHousNm},
            WRHOUS_DETAIL_ADRES = #{wrHousDetailAdres},
            WRHOUS_ZIP = #{wrHousZip},
            WRHOUS_OPER_STTUS = #{wrHousOperSttus},
            PARTCLR_MATTER = #{partclrMatter}
        WHERE WRHOUS_CODE = #{wrHousCode}
    </update>

    <!-- üìå Ï∞ΩÍ≥† ÌèêÏáÑ (Ïö¥ÏòÅ ÏÉÅÌÉú Î≥ÄÍ≤Ω) -->
    <update id="closeWarehouse" parameterType="java.lang.String">
        UPDATE TB_WAREHOUSE
        SET WRHOUS_OPER_STTUS = '02' -- 'ÌèêÏáÑ' ÏÉÅÌÉú
        WHERE WRHOUS_CODE = #{wrHousCode}
    </update>

    <!-- üìå Ï∞ΩÍ≥† Ï†ïÎ≥¥ ÏÇ≠Ï†ú -->
    <delete id="deleteWarehouse" parameterType="java.lang.String">
        DELETE FROM TB_WAREHOUSE WHERE WRHOUS_CODE = #{wrHousCode}
    </delete>
    
    <!-- üìå ÌäπÏ†ï Ï∞ΩÍ≥†Ïóê ÏûàÎäî ÏûêÏû¨ Í∞úÏàò Ï°∞Ìöå -->
    <select id="countMaterialsInWarehouse" parameterType="java.lang.String" resultType="int">
        SELECT COUNT(*) 
        FROM TB_WAREHOUSE_PRODUCT_LIST 
        WHERE WRHOUS_CODE = #{wrHousCode}
    </select>

    <!-- üìå ÎßàÏßÄÎßâÏúºÎ°ú ÏÇΩÏûÖÎêú Ï∞ΩÍ≥† ÏΩîÎìú Ï°∞Ìöå (Ïà´Ïûê Í∏∞Ï§Ä Ï†ïÎ†¨) -->
    <select id="getLastInsertedWarehouseCode" resultType="java.lang.String">
        SELECT WRHOUS_CODE 
        FROM TB_WAREHOUSE 
        ORDER BY TO_NUMBER(SUBSTR(WRHOUS_CODE, 3)) DESC 
        FETCH FIRST 1 ROWS ONLY
    </select>

</mapper>
